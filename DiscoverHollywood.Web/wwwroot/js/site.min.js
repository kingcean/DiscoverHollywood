var DiscoverHollywood;(function(n){function r(n){return n?encodeURIComponent(n.toString()):""}function e(n,t,i,u){return $.getJSON("/api/movies/?q="+r(n)+"&year="+r(t)+"&genres="+r(i)+"&page="+encodeURIComponent(u!=null?u.toString():""))}function o(n){return $.getJSON("/api/movies/"+n)}function s(n){return $.getJSON("/api/movies/"+n+"/ratings")}function h(n){return $.getJSON("/api/movies/"+n+"/tags")}function i(n){var t;if(n==null)return null;try{if(typeof n=="string")return(t=location.search.match(new RegExp("[?&]"+n+"=([^&]+)","i")),t==null||t.length<1)?"":t[1];if(typeof n=="number")return(t=location.search.match(new RegExp("[?&][^?&]+=[^?&]+","g")),t==null)?"":t[n].substring(1)}catch(i){}return null}function t(n){var r=i(n),t;try{return t=parseInt(r,10),t!=null&&!isNaN(t)?t:undefined}catch(u){return undefined}}function c(){var n=new f,u=function(){n.page(t("page")||0);n.q(i("q"));n.year(t("year"));n.genres(i("genres"));var r=t("id");n.updateList().then(function(){n.show(r)})},r;u();r=document.getElementById("page_container");ko.applyBindings(n,r);r.style.display="";window.addEventListener("popstate",function(){u()})}var u={pageSize:20},f=function(){function n(){this.hasFurther=ko.observable(!1);this.detail=ko.observable();this.rating=ko.observableArray();this.years=ko.observableArray();this.list=ko.observableArray();this.page=ko.observable(0);this.year=ko.observable();this.genres=ko.observable();this.tags=ko.observableArray();this.loadedTags=ko.observable(!1);this.isLoading=ko.observable(!1);this.q=ko.observable();this.genresList=["","Action","Adventure","Animation","Children's","Comedy","Crime","Documentary","Drama","Fantasy","Film-Noir","Horror","Musical","Mystery","Romance","Sci-Fi","Thriller","War","Western"];for(var n=2016;n>1995;n--)this.years.push(n)}return n.prototype.home=function(){this.detail(null);this.rating(null);this.tags(null);history.pushState(null,null,this.getSearchPath())},n.prototype.getList=function(){return e(this.q(),this.year(),this.genres(),this.page())},n.prototype.updateList=function(){var n=this,t;return this.isLoading(!0),this.page(0),t=this.getList(),t.then(function(t){if(t){if(n.list(t),n.isLoading(!1),t.length===1&&!!t[0]){n.show(t[0].id);return}n.hasFurther(t.length>=u.pageSize);history.pushState(null,null,n.getSearchPath())}},function(){n.isLoading(!1)}),t},n.prototype.getSearchPath=function(){var n="?";return!this.q()||(n+=(n.length>1?"&":"")+"q="+this.q()),!this.year()||(n+=(n.length>1?"&":"")+"year="+this.year()),!this.genres()||(n+=(n.length>1?"&":"")+"genres="+this.genres()),n},n.prototype.getMore=function(){var n=this,t;this.isLoading(!0);this.page((this.page()||0)+1);t=this.getList();t.then(function(t){(i=n.list).push.apply(i,t);n.isLoading(!1);n.hasFurther(t.length>=u.pageSize);var i},function(){n.isLoading(!1)})},n.prototype.show=function(n){var r=this,u,f,i;if(this.rating(null),n==null){this.detail(null);this.tags(null);return}u=t("id");u!=n&&history.pushState(u,null,"?id="+n);f=this.list();!f||f.some(function(t){return!t||t.id==null||t.id.toString()!==n.toString()?!1:(i=t,r.detail(i),!0)});i||o(n).then(function(n){i=n;r.detail(n)});s(n).then(function(n){r.rating(n)})},n.prototype.showTags=function(){var t=this,n=this.detail();n&&n.id!=null&&h(n.id).then(function(i){var r=t.detail();r&&r.id===n.id&&t.tags(!!i&&i.length>0?i:[{value:"(empty)",movie:n.id,id:null}])})},n.prototype.paddingNum=function(n,t){for(var i=n.toString(),r=i.length;r<t;r++)i="0"+i;return i},n}();n.PageModel=f;n.list=e;n.get=o;n.rating=s;n.tags=h;n.getQuery=i;n.getQueryAsInt=t;c()})(DiscoverHollywood||(DiscoverHollywood={}));